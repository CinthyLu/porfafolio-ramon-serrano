<!-- Users Management -->
<div class="users-container panel-admin">
  <h2>Administracion de usuarios</h2>
  <p>Administrar y ver todos los usuarios </p>

  <div class="filters">
    <label>Filtrar por rol</label>
    <select name="filterRole" [(ngModel)]="filterRole" (change)="applyFilter()">
      <option value="all">Todos</option>
      <option [value]="Role.Admin">Admin</option>
      <option [value]="Role.Programmer">Programmer</option>
      <option [value]="Role.User">User</option>
    </select>
  </div>

  <div class="users-table">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Email</th>
          <th>Rol</th>
          <th>Cambiar Role</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let u of filteredUsers" (click)="selectUser(u)" [class.selected]="isSelected(u)">
          <td>{{ u.fullName }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.role }}</td>

          <td>
            <span *ngIf="!isAdmin || !isSelected(u)">{{ u.role }}</span>

            <select *ngIf="isAdmin && isSelected(u)" [ngModel]="u.role" (ngModelChange)="changeRole(u, $event)"
              (click)="$event.stopPropagation()">
              <option [value]="Role.Admin">admin</option>
              <option [value]="Role.Programmer">programmer</option>
              <option [value]="Role.User">user</option>
            </select>
          </td>

          <td>
            <div *ngIf="isSelected(u)">
              <button class="btn btn-sm" type="button" (click)="startEdit(u); $event.stopPropagation()">
                Editar perfil
              </button>

              <button *ngIf="isAdmin" class="btn btn-sm" type="button"
                (click)="deleteUser(u.email); $event.stopPropagation()">
                Eliminar
              </button>
            </div>

            <div *ngIf="!isSelected(u)">-</div>
          </td>
        </tr>

        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="5">No hay usuarios para este filtro.</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="create-programmer">
    <h3>{{ editingId ? 'Editar' : 'Crear Programador' }}</h3>

    <form (ngSubmit)="saveProgrammer()">
      <label>Nombre</label>
      <input name="fullName" [(ngModel)]="fullName" required />

      <label>Email</label>
      <input name="email" [(ngModel)]="email" [readonly]="!!editingId" required />

      <label>Especialidad</label>
      <input name="specialty" [(ngModel)]="specialty" />

      <label>Breve descripci√≥n</label>
      <textarea name="bio" [(ngModel)]="bio"></textarea>

      <div class="form-actions">
        <button class="btn btn-primary" type="submit" [disabled]="creating">
          {{ editingId ? 'Guardar cambios' : 'Crear' }}
        </button>

        <button *ngIf="editingId" class="btn btn-secondary" type="button" (click)="cancelEdit()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div class="nav-buttons">
    <button class="btn btn-secondary" routerLink="/">Back to Home</button>
  </div>
</div>
