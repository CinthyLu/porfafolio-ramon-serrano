<!-- Loading -->
<div *ngIf="loading" class="loading-wrapper">
  <div class="spinner"></div>
  <p>Cargando autenticaci√≥n...</p>
</div>

<!-- notificaiones -->
<div class="notification" *ngIf="notification.visible" [ngClass]="notification.type">
  {{ notification.message }}
</div>

<!-- Contenido -->
<div *ngIf="!loading" class="schedule-wrapper">

  <!-- Error Message -->
  <div *ngIf="error" class="error-alert">
    <strong>‚ö†Ô∏è Aviso:</strong> {{ error }}
  </div>

  <div class="schedule-card">

    <h2 class="title">Agendar Asesor√≠a</h2>

    <!-- Si no hay programadores -->
    <div *ngIf="programmers.length === 0 && !loading" class="empty-state">
      <p>üì≠ No hay programadores disponibles en este momento.</p>
      <p>Por favor, intenta m√°s tarde.</p>
      <button class="btn-secondary" routerLink="/">Volver</button>
    </div>

    <!-- Formulario -->
    <form *ngIf="programmers.length > 0" #f="ngForm" (ngSubmit)="submit()">

      <!-- Programador -->
      <div class="form-group">
        <label>Seleccionar Programador</label>
        <select [(ngModel)]="selectedProgrammer" name="programmer" required #progCtrl="ngModel"
          [class.is-invalid]="progCtrl.invalid && progCtrl.touched"
          (change)="onProgrammerChange()">
          <option value="">-- Seleccionar --</option>
          <option *ngFor="let p of programmers" [value]="p.id">
            {{ p.fullName || p.name || p.email }} ‚Äî {{ getLabel(p) }}
          </option>
        </select>
        <small class="error" *ngIf="progCtrl.invalid && progCtrl.touched">Selecciona un programador</small>
      </div>

      <!-- Informaci√≥n de disponibilidad -->
      <div *ngIf="loadingAvailabilities" class="availability-loading">
        <div class="mini-spinner"></div>
        <span>Cargando horarios disponibles...</span>
      </div>

      <div *ngIf="availabilityInfo && !loadingAvailabilities" class="availability-info">
        <pre>{{ availabilityInfo }}</pre>
      </div>

      <!-- Fecha -->
      <div class="form-group">
        <label>Fecha</label>
        <input type="date" [(ngModel)]="date" name="date" [min]="minDate" required />
      </div>

      <!-- Hora -->
      <div class="form-group">
        <label>Hora</label>
        <input type="time" [(ngModel)]="time" name="time" required />
      </div>

      <!-- Comentario -->
      <div class="form-group">
        <label>Comentario (opcional)</label>
        <textarea [(ngModel)]="comment" name="comment" placeholder="Escribe un comentario opcional..."></textarea>
      </div>

      <!-- Bot√≥n -->
      <div class="form-actions">
        <button type="submit" [disabled]="submitting || !selectedProgrammer || !date || !time">
          {{ submitting ? 'Enviando...' : 'Enviar solicitud' }}
        </button>
      </div>

    </form>

    <div class="nav-actions">
      <button class="btn-secondary" routerLink="/">Volver</button>
    </div>

  </div>

</div>
